# 서버 (Backend) 개발 요구사항

## 📋 개요
FastAPI + Python을 사용한 거래 전략 실행 서버
KIS Open API 연동을 통한 실시간 주식 데이터 처리 및 자동 매매 시스템

## 🎯 핵심 작업 영역

### 1. KIS Open API 연동

#### 1.1 인증 및 토큰 관리
- OAuth 2.0 토큰 발급 시스템 구현
- 토큰 자동 갱신 로직 개발
- API 호출 인증 헤더 관리
- 토큰 만료 시 자동 재인증 처리

#### 1.2 주식 데이터 수집 API
- 전 종목 기본 정보 조회 (15:30 마감 기준)
  - 종가, 거래량, 시가총액, 업종 정보
  - VWAP, 체결강도, 후반부 거래량 데이터
- 개별 종목 상세 정보 조회
- 시간외 거래 가격 실시간 모니터링
- 실시간 호가/체결 데이터 수집

### 2. 종목 필터링 엔진 (Day 1: 15:30-16:00)

#### 2.1 필터링 조건 처리
- 6가지 핵심 필터링 조건 구현
  - 거래량 배수 (평균 대비 2.0배 이상)
  - 후반부 상승률 (14:00-15:30, 1% 이상)
  - 후반부 거래량 비중 (15% 이상)
  - 체결강도 (110 이상)
  - 시장 대비 상대 수익률 (1.5% 이상)
  - VWAP 대비 종가 비율 (102% 이상)

#### 2.2 기본 필터 적용
- 시가총액 범위 필터링 (1,000억~10조)
- 주가 범위 필터링 (1,000~500,000원)
- 업종 제외 필터 (스팩, 리츠, 우선주)
- 최소 일일 거래량 필터 (100억원)

#### 2.3 종목 점수 계산 시스템
- 각 조건별 가중치 적용 점수 산출
- 종목별 종합 점수 계산
- 점수순 정렬 및 랭킹 시스템

#### 2.4 동적 조건 조정 로직
- 필터링 결과에 따른 조건 자동 조정
  - 후보 부족시 (0~2개): 1/2/3단계 완화
  - 후보 과다시 (20개+): 조건 강화
- 조정된 조건으로 즉시 재필터링 실행

### 3. 시간외 거래 모니터링 (Day 1: 16:00-17:40)

#### 3.1 30분 단위 실시간 모니터링
- 16:00, 16:30, 17:00, 17:30 정시 체크
- 선택된 종목들의 시간외 가격 변동 추적
- 임계값(기본 2%) 돌파 여부 실시간 확인

#### 3.2 자동 매수 주문 시스템
- 조건 만족 시 설정된 금액으로 즉시 매수 실행
- 주문 결과 추적 및 상태 관리
- 매수 실패 시 재시도 로직

#### 3.3 시간외 동적 조정
- 선택 종목 모두 조건 미달시 임계값 하향 조정
- 백업 종목 리스트 활용 로직
- 새로운 필터링 조건으로 재검색

### 4. 포지션 관리 시스템 (Day 2: 09:00-15:30)

#### 4.1 실시간 손익 계산
- 보유 포지션별 현재가 추적
- 실시간 손익률 계산
- 누적 손익 및 수익률 통계

#### 4.2 시간 기반 청산 전략
- **09:00-13:00**: 익절 +5%, 손절 -3% 모니터링
- **13:00-15:00**: 익절 +3%, 손절 -3% + 50% 부분청산
- **15:00-15:20**: ±1.5% 범위 내 무조건 청산
- **15:20-15:30**: 손익 무관 강제 청산

#### 4.3 자동 청산 주문 시스템
- 목표가 달성시 즉시 청산 주문 실행
- 부분 청산 및 전량 청산 로직
- 강제 청산 시 지정가→시장가 전환

### 5. 데이터 저장 및 관리

#### 5.1 거래 세션 데이터 관리
- 일별 거래 세션 정보 저장
- 필터링 조건 및 결과 기록
- 선택 종목 및 투자 배분 정보

#### 5.2 포지션 데이터 관리
- 매수/매도 주문 이력 저장
- 포지션별 손익 계산 결과
- 거래 성과 통계 데이터

#### 5.3 성과 분석 데이터
- 일별/주별/월별 성과 집계
- 승률, 평균 수익률, 최대 드로우다운
- 전략 효과성 분석 지표

### 6. WebSocket 실시간 통신

#### 6.1 실시간 데이터 스트리밍
- 클라이언트와 WebSocket 연결 관리
- 실시간 가격 정보 브로드캐스트
- 매수/매도 신호 즉시 알림

#### 6.2 구독 관리 시스템
- 종목별 실시간 데이터 구독 관리
- 클라이언트별 개별 알림 설정
- 연결 상태 모니터링 및 재연결 처리

### 7. 스케줄링 및 자동화

#### 7.1 일일 작업 스케줄러
- **15:30**: 자동 필터링 시작
- **16:00/16:30/17:00/17:30**: 시간외 모니터링
- **09:00-15:30**: 포지션 모니터링 및 청산 관리

#### 7.2 백그라운드 작업 관리
- 실시간 데이터 수집 작업
- 주기적 토큰 갱신 작업
- 시스템 상태 모니터링 작업

### 8. API 엔드포인트 설계

#### 8.1 필터링 관련 API
- 종목 필터링 실행
- 조건 동적 조정
- 필터링 결과 조회

#### 8.2 포트폴리오 관련 API
- 포트폴리오 구성 설정
- 현재 포지션 조회
- 투자 배분 관리

#### 8.3 거래 관련 API
- 매수/매도 주문 실행
- 주문 상태 조회
- 거래 이력 조회

#### 8.4 모니터링 관련 API
- 시간외 거래 상황 조회
- 실시간 데이터 조회
- 시스템 상태 확인

### 9. 에러 처리 및 로깅

#### 9.1 예외 처리 시스템
- KIS API 호출 에러 처리
- 주문 실행 실패 처리
- 네트워크 연결 오류 처리

#### 9.2 로깅 및 모니터링
- 거래 활동 상세 로깅
- 시스템 성능 모니터링
- 에러 발생 시 알림 시스템

### 10. 보안 및 설정 관리

#### 10.1 보안 관리
- API 키 안전한 저장 및 관리
- 요청 제한 (Rate Limiting)
- 거래 데이터 암호화

#### 10.2 설정 관리
- 환경별 설정 파일 관리
- 거래 전략 파라미터 설정
- 시스템 운영 설정

## 🚀 개발 우선순위

### Phase 1: 기반 시스템 구축
- KIS Open API 연동 및 인증 시스템
- 기본 데이터 수집 및 저장 시스템
- FastAPI 기본 구조 및 데이터베이스 설계

### Phase 2: 필터링 엔진 개발
- 종목 필터링 로직 구현
- 동적 조건 조정 시스템
- 점수 계산 및 랭킹 시스템

### Phase 3: 시간외 거래 시스템
- 실시간 모니터링 시스템
- 자동 매수 주문 시스템
- 조건 조정 및 백업 로직

### Phase 4: 포지션 관리 시스템
- 실시간 손익 계산
- 시간 기반 청산 시스템
- 자동 매도 주문 시스템

### Phase 5: 실시간 통신 및 스케줄링
- WebSocket 통신 시스템
- 백그라운드 작업 스케줄러
- 실시간 알림 시스템

### Phase 6: 고도화 및 최적화
- 성과 분석 시스템
- 모니터링 및 로깅 시스템
- 보안 강화 및 성능 최적화

## 🔧 기술적 고려사항

### 성능 최적화
- 비동기 처리를 통한 동시성 확보
- Redis 캐싱을 통한 실시간 데이터 성능 향상
- 데이터베이스 인덱싱 및 쿼리 최적화

### 안정성 확보
- 장애 복구 및 재연결 로직
- 데이터 백업 및 복구 시스템
- 시스템 상태 모니터링 및 알림

### 확장성 고려
- 마이크로서비스 아키텍처 준비
- 로드 밸런싱 및 스케일링 전략
- 모듈화된 설계 및 플러그인 시스템